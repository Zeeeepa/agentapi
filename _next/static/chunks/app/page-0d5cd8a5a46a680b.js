(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2676:(e,t,r)=>{"use strict";r.d(t,{default:()=>i});var s=r(5155),n=r(2115);function l(e){let{messages:t,loading:r=!1}=e,l=(0,n.useRef)(null),a=(0,n.useRef)(0),o=(0,n.useRef)(!1);return((0,n.useEffect)(()=>{var e;let s=t[t.length-1],n=t.length>a.current&&(null==s?void 0:s.role)==="user",i=r!==o.current,c=null===(e=l.current)||void 0===e?void 0:e.parentElement;if(l.current&&c){let e=n||r||i,t=c.scrollHeight-c.scrollTop-c.clientHeight<100;(e||t)&&l.current.scrollIntoView({behavior:"smooth"})}a.current=t.length,o.current=r},[t,r]),0===t.length)?(0,s.jsx)("div",{className:"flex-1 p-6 flex items-center justify-center text-gray-500 bg-white",children:(0,s.jsx)("p",{children:"No messages yet. Start the conversation!"})}):(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 bg-white",children:[t.map(e=>(0,s.jsx)("div",{className:"mb-4 ".concat("user"===e.role?"text-right":""),children:(0,s.jsxs)("div",{className:"inline-block px-4 py-2 rounded-lg ".concat("user"===e.role?"bg-blue-500 text-white rounded-tr-none max-w-[90%]":"bg-gray-200 text-gray-800 rounded-tl-none max-w-[90%] min-w-[640px]"),children:[(0,s.jsx)("div",{className:"text-xs mb-1 font-bold text-left",children:"user"===e.role?"You":"AgentAPI"}),(0,s.jsx)("div",{className:"whitespace-pre-wrap break-words text-left ".concat("user"===e.role?"":"font-mono"),children:e.content})]})},e.id)),r&&(0,s.jsx)("div",{className:"mb-4 text-right",children:(0,s.jsxs)("div",{className:"inline-block px-4 py-2 rounded-lg bg-blue-500 text-white rounded-tr-none",children:[(0,s.jsx)("div",{className:"text-xs mb-1 font-bold text-left",children:"You"}),(0,s.jsx)("div",{className:"h-6 flex items-center",children:(0,s.jsx)(()=>(0,s.jsxs)("div",{className:"flex space-x-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-white animate-pulse",style:{animationDelay:"0ms"}}),(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-white animate-pulse",style:{animationDelay:"300ms"}}),(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-white animate-pulse",style:{animationDelay:"600ms"}})]}),{})})]})}),(0,s.jsx)("div",{ref:l})]})}function a(e){let{onSendMessage:t,disabled:r=!1}=e,[l,a]=(0,n.useState)(""),[o,i]=(0,n.useState)("text"),[c,d]=(0,n.useState)([]),u=(0,n.useRef)(null),x=(0,n.useRef)(0),[m,h]=(0,n.useState)(!1),f=e=>{e.preventDefault(),l.trim()&&!r&&(t(l,"user"),a(""))};(0,n.useEffect)(()=>{if(0===c.length)return;let e=setInterval(()=>{let e=Date.now();d(t=>t.filter(t=>e-t.timestamp<2e3))},100);return()=>clearInterval(e)},[c]);let g=e=>{let t={char:e,id:x.current++,timestamp:Date.now()};d(e=>[...e,t])},b=e=>{if("control"!==o||r)"Enter"!==e.key||e.shiftKey||(e.preventDefault(),f(e));else{let r={ArrowUp:"\x1b[A",ArrowDown:"\x1b[B",ArrowRight:"\x1b[C",ArrowLeft:"\x1b[D",Escape:"\x1b",Tab:"	",Delete:"\x1b[3~",Home:"\x1b[H",End:"\x1b[F",PageUp:"\x1b[5~",PageDown:"\x1b[6~",Backspace:"\b"};if(r[e.key]){e.preventDefault(),g(e.key),t(r[e.key],"raw");return}if("Enter"===e.key&&!e.shiftKey){e.preventDefault(),g("⏎"),t("\r","raw");return}if(e.ctrlKey){let r={c:"\x03",d:"\x04",z:"\x1a",l:"\f",a:"\x01",e:"\x05",w:"\x17",u:"\x15",r:"\x12"};if(r[e.key.toLowerCase()]){e.preventDefault(),g("Ctrl+".concat(e.key.toUpperCase())),t(r[e.key.toLowerCase()],"raw");return}}if(1===e.key.length){e.preventDefault(),g(e.key),t(e.key,"raw");return}}};return(0,n.useEffect)(()=>{u.current&&(u.current.focus(),"control"===o&&h(!0))},[o]),(0,s.jsx)("form",{onSubmit:f,className:"border-t border-gray-300 p-4 bg-white",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"mb-2 flex items-center",children:[(0,s.jsxs)("div",{className:"flex rounded-lg overflow-hidden border border-gray-300",children:[(0,s.jsx)("button",{type:"button",onClick:()=>i("text"),className:"px-3 py-1 text-sm font-medium ".concat("text"===o?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Text"}),(0,s.jsx)("button",{type:"button",onClick:()=>i("control"),className:"px-3 py-1 text-sm font-medium ".concat("control"===o?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Control"})]}),(0,s.jsxs)("span",{className:"ml-3 text-xs text-gray-600",children:["Switch to ",(0,s.jsx)("span",{className:"font-medium",children:"Control"})," mode to send raw keystrokes (↑,↓,Tab,Ctrl+C,Ctrl+R) directly to the terminal"]})]}),"control"===o&&!r&&(0,s.jsxs)("div",{className:"mb-1 text-xs text-blue-600 font-mono flex justify-between",children:[(0,s.jsx)("span",{children:"Control mode - keystrokes sent directly to terminal"}),c.length>0&&(0,s.jsx)("div",{className:"flex space-x-1",children:c.map(e=>(0,s.jsx)("span",{className:"font-mono px-1 bg-blue-100 rounded text-blue-800 transition-opacity",style:{opacity:Math.max(0,1-(Date.now()-e.timestamp)/2e3)},children:e.char},e.id))})]}),(0,s.jsx)("div",{className:"flex",children:"control"!==o||r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("textarea",{ref:u,value:l,onChange:e=>a(e.target.value),onKeyDown:b,placeholder:r?"Server offline...":"Type a message...",className:"flex-1 resize-none border rounded-l-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",rows:2,disabled:r}),(0,s.jsx)("button",{type:"submit",disabled:r||!l.trim(),className:"bg-blue-500 text-white px-4 rounded-r-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Send"})]}):(0,s.jsx)("div",{ref:u,tabIndex:0,onKeyDown:b,onFocus:()=>h(!0),onBlur:()=>h(!1),className:"flex-1 cursor-text border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-500 bg-gray-50 border-blue-200 min-h-[3.5rem] flex items-center justify-center",children:m?"Press any key to send to terminal (arrows, Ctrl+C, Ctrl+R, etc.)":"Click or focus this area to send keystrokes to terminal"})})]})})}var o=r(8999);function i(){let[e,t]=(0,n.useState)([]),[r,i]=(0,n.useState)(!1),[c,d]=(0,n.useState)("unknown"),u=parseInt((0,o.useSearchParams)().get("port")),[x,m]=(0,n.useState)(isNaN(u)?3284:u),[h,f]=(0,n.useState)(x.toString()),g="http://localhost:".concat(x),b=(0,n.useRef)(null);(0,n.useEffect)(()=>{f(x.toString())},[x]),(0,n.useEffect)(()=>{let e=()=>{b.current&&b.current.close(),t([]);let r=new EventSource("".concat(g,"/events"));return b.current=r,r.addEventListener("message_update",e=>{let r=JSON.parse(e.data);t(e=>{let t=e.findIndex(e=>e.id===r.id);if(-1===t)return[...e,{role:r.role,content:r.message,id:r.id}];{let s=[...e];return s[t]={role:r.role,content:r.message,id:r.id},s}})}),r.addEventListener("status_change",e=>{d(JSON.parse(e.data).status)}),r.onopen=()=>{console.log("EventSource connection established - messages reset")},r.onerror=t=>{console.error("EventSource error:",t),d("offline"),setTimeout(()=>{b.current&&e()},3e3)},r},r=e();return()=>{r.close()}},[g]);let[p,y]=(0,n.useState)(null),w=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"user";if("user"!==t||e.trim()){y(null),"user"===t&&i(!0);try{let r=await fetch("".concat(g,"/message"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e,type:t})});if(!r.ok){let e=await r.json();console.error("Failed to send message:",e);let t=e.detail,s="errors"in e?e.errors.map(e=>e.message).join(", "):"",n="".concat(t,": ").concat(s);y("Failed to send message: ".concat(n)),setTimeout(()=>y(null),5e3)}}catch(s){console.error("Error sending message:",s);let e=s.detail,t="errors"in s?s.errors.map(e=>e.message).join("\n"):"",r="".concat(e,": ").concat(t);y("Error sending message: ".concat(r)),setTimeout(()=>y(null),5e3)}finally{"user"===t&&i(!1)}}},v=()=>{let e=parseInt(h);!isNaN(e)&&e>0&&e<65536?window.location.href="?port=".concat(e):(y("Invalid port number. Please enter a number between 1-65535."),setTimeout(()=>y(null),5e3))};return(0,s.jsxs)("div",{className:"flex flex-col h-[80vh] bg-gray-100 rounded-lg overflow-hidden border border-gray-300 shadow-lg w-full max-w-[95vw]",children:[(0,s.jsxs)("div",{className:"p-3 bg-gray-800 text-white text-sm flex items-center justify-between",children:[(0,s.jsx)("span",{children:"AgentAPI Chat"}),(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("label",{htmlFor:"port-input",className:"text-white mr-1",children:"Port:"}),(0,s.jsx)("input",{id:"port-input",type:"text",value:h,onChange:e=>f(e.target.value),className:"w-16 px-1 py-0.5 text-xs rounded border border-gray-400 bg-gray-700 text-white",onKeyDown:e=>"Enter"===e.key&&v()}),(0,s.jsx)("button",{onClick:v,className:"ml-1 px-2 py-0.5 text-xs bg-gray-600 hover:bg-gray-500 rounded",children:"Apply"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full mr-2 ".concat(["offline","unknown"].includes(c)?"bg-red-500":"bg-green-500")}),(0,s.jsxs)("span",{children:["Status: ",c]})]})]})]}),("offline"===c||"unknown"===c)&&(0,s.jsxs)("div",{className:"bg-yellow-100 border-y border-yellow-400 text-yellow-800 px-4 py-3 flex items-center justify-between font-medium",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,s.jsxs)("span",{children:["API server is offline. Please start the API server on localhost:",x,"."]})]}),(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-yellow-200 px-3 py-1 rounded text-xs hover:bg-yellow-300",children:"Retry Connection"})]}),p&&(0,s.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-2 text-sm relative",children:[(0,s.jsx)("span",{className:"block sm:inline",children:p}),(0,s.jsx)("button",{onClick:()=>y(null),className:"absolute top-0 bottom-0 right-0 px-4 py-2",children:"\xd7"})]}),(0,s.jsx)(l,{messages:e,loading:r}),(0,s.jsx)(a,{onSendMessage:w,disabled:r})]})}},9587:(e,t,r)=>{Promise.resolve().then(r.bind(r,2676))}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(9587)),_N_E=e.O()}]);